version: 2

sources:
  - name: tele_customer
    schema: SF_SCHEMA
    database: SNOWFLAKE_DBT_DATA
    tables:
      - name: TELECOM_CUSTOMERS
        identifier: TELECOM_CUSTOMERS
        columns:
          - name: customer_id
            tests:
              - not_null
              - unique
          - name: email
            tests:
              - not_null:
                  severity: warn 
          - name: mobile_number
            tests:
              - not_null
              - unique
          - name: gender
            tests:
              - accepted_values:
                  values: ['Male', 'Female']
          - name: age
            tests:
              - not_null
              - value_between_range:
                  min_value: 18
                  max_value : 100
  - name: tele_telecom_plans
    schema: SF_SCHEMA
    database: SNOWFLAKE_DBT_DATA
    tables:
      - name: TELE_PLANS
        identifier: TELECOM_PLANS
        columns:
          - name: plan_id
            tests:
              - not_null
              - unique
          - name: customer_id
            tests:
              - not_null
              - relationships:
                  to: source('tele_customer', 'TELECOM_CUSTOMERS')
                  field: customer_id
          - name: plan_type
            tests:
              - accepted_values:
                  values: ['Prepaid', 'Postpaid']
          - name: price
            tests:
              - not_null
models:
  - name: test_customer_tele
    columns:
      - name: customer_id
        tests:
          - not_null
          - unique 
      - name: email
        tests:
          - valid_email_format
          - unique
    tests:
      - duplicate_check:
          column_names: ['EMAIL', 'FULL_NAME']
